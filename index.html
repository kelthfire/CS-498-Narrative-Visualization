<html>
<script src="https://d3js.org/d3.v5.min.js"></script>

<head>
  <title>Literacy Rates in India (2011)</title>
</head>

<body onload="init()">
<h1>Literacy Rates in India (2011)</h1>

<h2 id="topTitle">Graph 1</h2>
<svg id="top"></svg>
</br>
<h2 id="bottomTitle">Graph 2</h2>
<svg id="bottom"></svg>
</body>
<script>
//------Establish Page Formatting------//

// Graph Margin and Dimensions
var margin = {top: 10, right: 50, bottom: 40, left: 50};
var width = 800 - margin.left - margin.right;
var height = 400 - margin.top - margin.bottom;

// Palettes
var colorMF = d3.scaleOrdinal()
	.domain(["Male","Female"])
	.range(['#f28e2b','#4e79a7'])
var colorUR = d3.scaleOrdinal()
	.domain(["Urban","Rural"])
	.range(['#b07aa1','#f1ce63'])
		

// X and Y Scales
var x = d3.scaleLinear()
.domain([0,100])
.range([ 0, width ]);
var y = d3.scaleLinear()
.domain([0,100])
.range([ height, 0 ]);


//Data
var literacyMF;
var literacyUR;

var states = [
"NATIONAL",
"ANDAMAN & NICOBAR ISLANDS",
"ANDHRA PRADESH",
"ARUNACHAL PRADESH",
"ASSAM",
"BIHAR",
"CHANDIGARH",
"CHHATTISGARH",
"DADRA & NAGAR HAVELI",
"DAMAN & DIU",
"DELHI",
"GOA",
"GUJARAT",
"HARYANA",
"HIMACHAL PRADESH",
"JAMMU & KASHMIR",
"JHARKHAND",
"KARNATAKA",
"KERALA",
"LAKSHADWEEP",
"MADHYA PRADESH",
"MAHARASHTRA",
"MANIPUR",
"MEGHALAYA",
"MIZORAM",
"NAGALAND",
"ODISHA",
"PUDUCHERRY",
"PUNJAB",
"RAJASTHAN",
"SIKKIM",
"TAMIL NADU",
"TRIPURA",
"UTTAR PRADESH",
"UTTARAKHAND",
"WEST BENGAL"]


// Initializiaton
async function init(){
	
	// Load Data
	literacyMF = await d3.csv("https://kelthfire.github.io/CS-498-Narrative-Visualization/Literacy by MF.csv", function(d){
		return {
			State: d.State,
			Age: parseInt(d.Age),
			Sex: d.Sex,
			LiteracyRate: parseFloat(d.LiteracyRate)
		};
	});
	
	literacyUR = await d3.csv("https://kelthfire.github.io/CS-498-Narrative-Visualization/Literacy by UR.csv", function(d){
	return {
		State: d.State,
		Age: parseInt(d.Age),
		UrbanRural: d.UrbanRural,
		LiteracyRate: parseFloat(d.LiteracyRate)
	};
});

	// Set Size
	setSize("#top")
	setSize("#bottom")
	
	// Draw the axes
	drawAxes("#top");
	drawAxes("#bottom");

	drawLines("#top",literacyMF,colorMF,"NATIONAL");
	drawLines("#bottom",literacyUR,colorUR,"NATIONAL");
}

function setSize(id){
	d3.select(id)
		.attr("width", width + margin.left + margin.right)
		.attr("height", height + margin.top + margin.bottom);
}

// Get Graph Transofrm
function ggt(id){
	return d3.select(id)
	.append("g")
	.attr("transform",
		  "translate(" + margin.left + "," + margin.top + ")");
}

function drawAxes(id){

	// Get the graph transform
	graph = ggt(id)

	// X Axis
	graph.append("g")
	.attr("transform", "translate(0," + height + ")")
	.call(d3.axisBottom(x).ticks(10));
	graph.append("text")
	.attr("class", "x label")
	.attr("text-anchor", "middle")
	.attr("x", width/2)
	.attr("y", height + margin.bottom-5)
	.text("Age");
	
	// Y axis
	graph.append("g")
	.call(d3.axisLeft(y));
	graph.append("text")
	.attr("class", "y label")
	.attr("text-anchor", "middle")
	.attr("x",-height/2)
	.attr("y",-margin.left+20)
	.attr("transform", "rotate(-90)")
	.text("Literacy Rate (%)");
}

function drawLines(id,data,colors,state){
	
	// Get the graph transform
	graph = ggt(id);
	
	
	var stateNesting = d3.nest()
	.key(function(d) {return d.Sex;})
	.entries(data.filter(function(d){if(d.State==state){return d;}}));
	

	// Draw the line
	graph.selectAll(".line")
		.data(stateNesting)
		.enter()
		.append("path")
		.attr("id","lines")
		.attr("fill", "none")
		.attr("stroke", function(d){ return colors(d.key) })
		.attr("stroke-width", 2.5)
		.attr("d", function(d){
		return d3.line()
			.x(function(d) { return x(d.Age); })
			.y(function(d) { return y(+d.LiteracyRate); })
			(d.values)
        })
}

function removeLines(id){
	d3.select(id).selectAll("#lines").remove();
}

function updatePlot(id,state){
	removeLines(id);
	drawLines(id,state)
}

</script>
</html>