<html>
<script src="https://d3js.org/d3.v5.min.js"></script>

<head>
  <title>Literacy Rates in India (2011)</title>
</head>

<body onload="init()">

	<table width = "1600" border = "0">
		<tr>
			<td colspan = "2">
				<h1>Literacy Rates in India (2011)</h1>
			</td>
		</tr>
		<tr valign = "top">
			<td id="graphWindow" width="800">
				<h2>Literacy Rate By Sex</h2>
				<svg id="top"></svg>
				</br>
				<h2>Literacy Rate By Urban/Rural</h2>
				<svg id="bottom"></svg>
			</td>
			<td id="textWindow">
				<h2>Hello!</h2>
			</td>
		</tr>

	</table>

</body>
<script>
//------Establish Page Formatting------//

// Graph Margin and Dimensions
var margin = {top: 10, right: 50, bottom: 40, left: 50};
var width = 800 - margin.left - margin.right;
var height = 400 - margin.top - margin.bottom;



// Palettes
var colorMF = d3.scaleOrdinal()
	.domain(["Male","Female"])
	.range(['#f28e2b','#4e79a7'])
var colorUR = d3.scaleOrdinal()
	.domain(["Urban","Rural"])
	.range(['#b07aa1','#f1ce63'])
		

// X and Y Scales
var x = d3.scaleLinear()
.domain([0,100])
.range([ 0, width ]);
var y = d3.scaleLinear()
.domain([0,100])
.range([ height, 0 ]);


//Data
var literacyMF;
var literacyUR;

var states = [
"NATIONAL",
"ANDAMAN & NICOBAR ISLANDS",
"ANDHRA PRADESH",
"ARUNACHAL PRADESH",
"ASSAM",
"BIHAR",
"CHANDIGARH",
"CHHATTISGARH",
"DADRA & NAGAR HAVELI",
"DAMAN & DIU",
"DELHI",
"GOA",
"GUJARAT",
"HARYANA",
"HIMACHAL PRADESH",
"JAMMU & KASHMIR",
"JHARKHAND",
"KARNATAKA",
"KERALA",
"LAKSHADWEEP",
"MADHYA PRADESH",
"MAHARASHTRA",
"MANIPUR",
"MEGHALAYA",
"MIZORAM",
"NAGALAND",
"ODISHA",
"PUDUCHERRY",
"PUNJAB",
"RAJASTHAN",
"SIKKIM",
"TAMIL NADU",
"TRIPURA",
"UTTAR PRADESH",
"UTTARAKHAND",
"WEST BENGAL"]


// Initializiaton
async function init(){
	
	// Load Data
	literacyMF = await d3.csv("https://kelthfire.github.io/CS-498-Narrative-Visualization/Literacy by MF.csv", function(d){
		return {
			State: d.State,
			Age: parseInt(d.Age),
			Sex: d.Sex,
			LiteracyRate: parseFloat(d.LiteracyRate)
		};
	});
	
	literacyUR = await d3.csv("https://kelthfire.github.io/CS-498-Narrative-Visualization/Literacy by UR.csv", function(d){
	return {
		State: d.State,
		Age: parseInt(d.Age),
		UrbanRural: d.UrbanRural,
		LiteracyRate: parseFloat(d.LiteracyRate)
	};
});

	// Set Size
	setSize("#top")
	setSize("#bottom")
	
	// Draw the axes
	drawAxes("#top");
	drawAxes("#bottom");
	
	//Enable Arrowheads
	enableArrowhead("#top");
	enableArrowhead("#bottom");
	
	// Draw legend
	drawLegend("#top",["Male","Female"],colorMF);
	drawLegend("#bottom",["Urban","Rural"],colorUR);
	
	// Draw First Graph
	drawLines("#top","MF","NATIONAL");
	drawLines("#bottom","UR","NATIONAL");
	
	//Draw Arrow
	drawArrow("#top",30,100,55,85);
}


function drawArrow(id,x1,y1,x2,y2){
	// Get the graph transform
	graph = ggt(id);
	
	graph.append("line")
	.attr("class","arrow")
	.attr("marker-end","url(#arrowhead")
	.attr("x1",x(x1))
	.attr("x2",x(x2))
	.attr("y1",y(y1))
	.attr("y2",y(y2))
	.attr("fill", "none")
	.attr("stroke", "#8cd17d")
	.attr("stroke-width", 6)
	
}

function deleteArrows(id){
	d3.select(id).selectAll(".arrow").remove();
}

function enableArrowhead(id){
	d3.select(id)
	.append("defs")
	.append("marker")
	.attr("id","arrowhead")
	.attr("viewBox","0 -5 10 10")
	.attr("refX",5)
	.attr("refY",0)
	.attr("markerWidth",4)
	.attr("markerHeight",4)
	.attr("orient","auto")
	.append("path")
	.attr("d", "M0,-5L10,0L0,5")
	.attr("fill","#8cd17d");
}

function setSize(id){
	d3.select(id)
		.attr("width", width + margin.left + margin.right)
		.attr("height", height + margin.top + margin.bottom);
}

// Get Graph Transofrm
function ggt(id){
	return d3.select(id)
	.append("g")
	.attr("transform",
		  "translate(" + margin.left + "," + margin.top + ")");
}

function drawAxes(id){

	// Get the graph transform
	graph = ggt(id)

	// X Axis
	graph.append("g")
	.attr("transform", "translate(0," + height + ")")
	.call(d3.axisBottom(x).ticks(10));
	graph.append("text")
	.attr("class", "x label")
	.attr("text-anchor", "middle")
	.attr("x", width/2)
	.attr("y", height + margin.bottom-5)
	.text("Age");
	
	// Y axis
	graph.append("g")
	.call(d3.axisLeft(y));
	graph.append("text")
	.attr("class", "y label")
	.attr("text-anchor", "middle")
	.attr("x",-height/2)
	.attr("y",-margin.left+20)
	.attr("transform", "rotate(-90)")
	.text("Literacy Rate (%)");
}

function drawLegend(id,legend,colors){
	var size = 20;
	d3.select(id).selectAll("legendBoxes")
	.data(legend)
	.enter()
	.append("rect")
	.attr("x",margin.left + 30)
	.attr("y", function(d,i){ return height - margin.bottom - 30 + i*(size+7)})
	.attr("width", size)
	.attr("height", size)
	.attr("fill", function(d) {return colors(d)});
	
	d3.select(id).selectAll("legendText")
	.data(legend)
	.enter()
	.append("text")
	.attr("x",margin.left + 30 + size*1.4)
	.attr("y", function(d,i){ return height - margin.bottom - 30 + i*(size+7) + (size/2)})
	.style("fill", function(d){ return colors(d)})
	.text(function(d){ return d})
	.attr("text-anchor", "left")
	.style("alignment-baseline", "middle")
}

function drawLines(id,MFUR,state){
	
	// Get the graph transform
	graph = ggt(id);
	
	// Get the nesting and colors 
	var stateNesting;
	var colors;
	if(MFUR=="MF"){
		stateNesting = d3.nest()
			.key(function(d) {return d.Sex;})
			.entries(literacyMF.filter(function(d){if(d.State==state){return d;}}));
		colors = colorMF;
	}
	if(MFUR=="UR"){
		stateNesting = d3.nest()
			.key(function(d) {return d.UrbanRural;})
			.entries(literacyUR.filter(function(d){if(d.State==state){return d;}}));
		colors = colorUR;
	}

	// Draw the line
	graph.selectAll(".line")
		.data(stateNesting)
		.enter()
		.append("path")
		.attr("class","line")
		.attr("fill", "none")
		.attr("stroke", function(d){ return colors(d.key) })
		.attr("stroke-width", 2.5)
		.attr("d", function(d){
		return d3.line()
			.x(function(d) { return x(d.Age); })
			.y(function(d) { return y(+d.LiteracyRate); })
			(d.values)
        })
}

function removeLines(id){
	d3.select(id).selectAll(".line").remove();
}

function updatePlot(id,MFUR,state){
	removeLines(id);
	drawLines(id,MFUR,state)
}

</script>
</html>